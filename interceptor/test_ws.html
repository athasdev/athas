<!DOCTYPE html>
<html>
<head>
    <title>Interceptor WebSocket Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #fff;
        }
        #messages {
            background: #2e2e2e;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
            border: 1px solid #444;
            margin-top: 10px;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            background: #3e3e3e;
            border-radius: 3px;
        }
        .status {
            color: #4fc3f7;
        }
        .error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <h1>Claude Code Interceptor WebSocket Test</h1>
    <div id="status" class="status">Connecting...</div>
    <div id="messages"></div>

    <script>
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');
        
        function addMessage(content, isError = false) {
            const msg = document.createElement('div');
            msg.className = isError ? 'message error' : 'message';
            msg.textContent = new Date().toISOString() + ': ' + content;
            messagesEl.appendChild(msg);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        const ws = new WebSocket('ws://localhost:3456/ws');

        ws.onopen = () => {
            statusEl.textContent = 'Connected to interceptor WebSocket';
            addMessage('WebSocket connection established');
        };

        ws.onmessage = (event) => {
            try {
                const message = JSON.parse(event.data);
                addMessage('Received: ' + JSON.stringify(message, null, 2));
            } catch (e) {
                addMessage('Raw message: ' + event.data);
            }
        };

        ws.onerror = (error) => {
            statusEl.textContent = 'Error: ' + error;
            addMessage('WebSocket error', true);
        };

        ws.onclose = () => {
            statusEl.textContent = 'Disconnected';
            addMessage('WebSocket connection closed');
        };
    </script>
</body>
</html>